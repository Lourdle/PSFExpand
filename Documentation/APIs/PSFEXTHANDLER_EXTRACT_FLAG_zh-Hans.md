# PSFEXTHANDLER_EXTRACT_FLAG
用于文件提取或展开的标识。通过按位`或`(OR)`|`应用多个标识。
````c
#define PSFEXTHANDLER_EXTRACT_FLAG_VERIFY                               ((WORD)0x0001)
#define PSFEXTHANDLER_EXTRACT_FLAG_SKIP_EXISTS                          ((WORD)0x0002)
#define PSFEXTHANDLER_EXTRACT_FLAG_FAIL_IF_EXISTS                       ((WORD)0x0004)
#define PSFEXTHANDLER_EXTRACT_FLAG_SINGLE_THREAD                        ((WORD)0x0008)
#define PSFEXTHANDLER_EXTRACT_FLAG_WRITE_BAD_DATA                       ((WORD)0x0010)
#define PSFEXTHANDLER_EXTRACT_FLAG_CONTINUE_EVEN_IF_OPERATION_FAILS     ((WORD)0x0020)
#define PSFEXTHANDLER_EXTRACT_FLAG_WRITE_DATA_TO_HANDLE                 ((WORD)0x0040)
#define PSFEXTHANDLER_EXTRACT_FLAG_KEEP_ORIGINAL_FORMAT                 ((WORD)0x0080)
#define PSFEXTHANDLER_EXTRACT_FLAG_ALLOW_CALLING_PROGGRESS_PROC_NOT_ON_THE_MAIN_THREAD\
                                                                        ((WORD)0x0100)
#define PSFEXTHANDLER_EXTRACT_FLAG_DISPATCH_MESSAGES_SYNCHRONOUSLY      ((WORD)0x0200)
````
>PSFEXTHANDLER_EXTRACT_FLAG_VERIFY
>在写入文件之前验证数据是否完好。

>PSFEXTHANDLER_EXTRACT_FLAG_SKIP_EXISTS
>写文件时如果文件已经存在，则跳过。

>PSFEXTHANDLER_EXTRACT_FLAG_FAIL_IF_EXISTS
>写文件时如果文件存在，函数失败。

>PSFEXTHANDLER_EXTRACT_FLAG_SINGLE_THREAD
>对 PSFExtHandler_Expand 函数，在展开文件时使用单线程。其他文件提取函数本身就是单线程提取，会忽略此标识。

>PSFEXTHANDLER_EXTRACT_FLAG_WRITE_BAD_DATA
>在验证文件不完好任要写文件。

>PSFEXTHANDLER_EXTRACT_FLAG_CONTINUE_EVEN_IF_OPERATION_FAILS
>在某些操作失败但错误非致命时继续执行函数。

>PSFEXTHANDLER_EXTRACT_FLAG_WRITE_DATA_TO_HANDLE	
>将文件写入到一个提供的句柄而不是指定文件。

>PSFEXTHANDLER_EXTRACT_FLAG_KEEP_ORIGINAL_FORMAT
>保持在 PSF 文件的格式写文件。

>PSFEXTHANDLER_EXTRACT_FLAG_ALLOW_CALLING_PROGGRESS_PROC_NOT_ON_THE_MAIN_THREAD
>对 PSFExtHandler_Expand 函数，在展开文件过程中调用进度报告函数时允许不在主线程（调用 PSFExtHandler_Expand 的线程）调用。其他提取函数不接受此标识。

>PSFEXTHANDLER_EXTRACT_FLAG_DISPATCH_MESSAGES_SYNCHRONOUSLY
>对 PSFExtHandler_Expand 函数，在展开文件过程中同步调用进度报告函数。其他函数不接受此标识。

### 备注
1. >PSF Extraction Handler 所有提取函数写文件发现同名文件默认会覆盖文件，除非指定相应标识。PSFEXTHANDLER_EXTRACT_FLAG_SKIP_EXISTS 和 PSFEXTHANDLER_EXTRACT_FLAG_FAIL_IF_EXISTS 标识冲突，不同时接受二者。

2. >指定 PSFEXTHANDLER_EXTRACT_FLAG_WRITE_BAD_DATA 标识同时应与 PSFEXTHANDLER_EXTRACT_FLAG_VERIFY 搭配。二者同时存在时若文件损坏任然会继续，如果成功则返回 TRUE，同时会设置 LastError 为 ERROR_INVALID_DATA。

3. >使用 PSFEXTHANDLER_EXTRACT_FLAG_WRITE_DATA_TO_HANDLE 标识，应在输出文件名参数提供句柄，必须保证提供的句柄可写，可以在此提供 IO 设备句柄（如：文件、管道等）。仅 PSFExtHandler_ExtractFileByIndex 和 PSFExtHandler_ExtractFile 函数可用。
   >>示例：
   >>BOOL ret = PSFExtHandler_ExtractFileByIndex(hPSF, 0, (PCWSTR)hFile, PSFEXTHANDLER_EXTRACT_FLAG_WRITE_DATA_TO_HANDLE);

4. >指定 PSFEXTHANDLER_EXTRACT_FLAG_KEEP_ORIGINAL_FORMAT 将不会对数据进行处理，对于不受支持的文件类型，搭配此标识才能写文件。

5. >- 如果指定 PSFEXTHANDLER_EXTRACT_FLAG_SINGLE_THREAD 标识 PSFEXTHANDLER_EXTRACT_FLAG_ALLOW_CALLING_PROGGRESS_PROC_NOT_ON_THE_MAIN_THREAD 和 PSFEXTHANDLER_EXTRACT_FLAG_DISPATCH_MESSAGES_SYNCHRONOUSLY 标识会被忽略。
   >- 指定 PSFEXTHANDLER_EXTRACT_FLAG_ALLOW_CALLING_PROGGRESS_PROC_NOT_ON_THE_MAIN_THREAD | PSFEXTHANDLER_EXTRACT_FLAG_DISPATCH_MESSAGES_SYNCHRONOUSLY 后，每个线程完成一个文件提取后会等待进度报告函数返回才会调用进度报告函数，函数返回才会继续。PSFExtHandler_Expand 会保证同一个时刻只会有一条线程调用进度报告函数。
   >- 谨慎仅指定 PSFEXTHANDLER_EXTRACT_FLAG_DISPATCH_MESSAGES_SYNCHRONOUSLY，如此每个线程完成一个文件提取后会等待进度报告函数返回才会调用进度报告函数，多个线程会通过消息队列向主线程发送进度信息消息，当主线程的线程报告函数返回后才会继续。但这样同步发送消息耗时长，加上限制文件展开速度的主要原因是硬盘读写速度而不是 CPU 的单核运算速度，多线程对速度的影响本就不会太大，因此甚至总体速度可能还没有单线程快。
   >- 不指定 PSFEXTHANDLER_EXTRACT_FLAG_DISPATCH_MESSAGES_SYNCHRONOUSLY 和 PSFEXTHANDLER_EXTRACT_FLAG_ALLOW_CALLING_PROGGRESS_PROC_NOT_ON_THE_MAIN_THREAD 标识，每条线程完成文件提取操作后会把进度信息消息加入消息队列，然后继续下一个文件的提取。主线程会调用进度报告函数，函数返回后释放消息所占内存空间，继续处理下一个消息。
